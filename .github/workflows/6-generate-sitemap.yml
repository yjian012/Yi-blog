name: Generate xml sitemap
on:
  push:
    branches:
        - main
permissions:
    contents: write
jobs:
    sitemap_job:
        if: ${{ !github.event.repository.is_template }}
        runs-on: ubuntu-latest
        
        steps:
        - name: Checkout the repo
          uses: actions/checkout@v3
          with:
            fetch-depth: 0 
            
        - name: Generate the sitemap
          id: sitemap
          uses: cicirello/generate-sitemap@v1
          with:
            base-url-path: https://yjian012.github.io/Yi-blog/
            path-to-root: /home/runner/work/Yi-blog/Yi-blog/
            additional-extensions: md
            
        - name: Output stats
          run: |
            echo "sitemap-path = ${{ steps.sitemap.outputs.sitemap-path }}"
            echo "url-count = ${{ steps.sitemap.outputs.url-count }}"
            echo "excluded-count = ${{ steps.sitemap.outputs.excluded-count }}"
            
        - name: Commit and push
          run: |
            if [[ `git status --porcelain sitemap.xml` ]]; then
              git config --global user.name 'github-actions'
              git config --global user.email '41898282+github-actions[bot]@users.noreply.github.com'
              git add sitemap.xml
              git commit -m "Automated sitemap update" sitemap.xml
              git push
            fi